<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fitness Health Analyzer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Fonts for Classic Look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Playfair+Display:wght@600;700;900&display=swap');

        .font-playfair {
            font-family: 'Playfair Display', serif;
        }

        .font-inter {
            font-family: 'Inter', sans-serif;
        }

        /* Define custom shadow for richer cards */
        .shadow-2xl {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        /* Custom animation for background blobs */
        @keyframes pulse-slow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .animate-pulse-slow {
            animation: pulse-slow 10s infinite ease-in-out;
        }
    </style>
</head>
<body class="font-inter">

    <!-- Main Container & Background -->
    <div id="app" class="min-h-screen bg-gradient-to-br from-indigo-100 via-pink-50 to-blue-50 p-6 relative overflow-hidden">
        <!-- Floating Background Blobs -->
        <div class="absolute top-0 left-0 w-[600px] h-[600px] bg-indigo-300/30 blur-[160px] rounded-full -z-10 animate-pulse-slow"></div>
        <div class="absolute bottom-0 right-0 w-[500px] h-[500px] bg-pink-300/40 blur-[160px] rounded-full -z-10 animate-pulse-slow delay-500"></div>

        <div class="max-w-6xl mx-auto space-y-10">
            <!-- Header Section -->
            <header class="text-center bg-white/60 backdrop-blur-lg p-8 rounded-3xl shadow-xl border border-indigo-100">
                <h1 class="text-5xl font-playfair font-bold text-indigo-800 mb-3">üèãÔ∏è‚Äç‚ôÇÔ∏è AI Fitness Health Analyzer</h1>
                <p class="text-gray-700 text-lg">Transforming your screenshots into actionable health insights with AI.</p>
            </header>

            <!-- Navigation Tabs -->
            <nav id="nav-container" class="flex justify-center space-x-6 bg-white/70 backdrop-blur-md p-3 rounded-full shadow-md border border-gray-200"></nav>

            <!-- Dynamic Content Area -->
            <div id="content-area">
                <!-- Content will be rendered here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Lucide Icons (Used for UI) -->
    <script type="module">
        import { createIcons, CloudUpload, Zap, BarChart, Activity, Utensils, MessageSquare, History, Info, Clock, Sparkles, HeartPulse } from 'https://cdn.jsdelivr.net/npm/lucide@latest/dist/esm/lucide.js';
        
        // This makes icons globally available for use in the render functions
        window.lucide = { CloudUpload, Zap, BarChart, Activity, Utensils, MessageSquare, History, Info, Clock, Sparkles, HeartPulse };
        
        // --- VANILLA JS APPLICATION LOGIC ---

        // --- GLOBAL STATE ---
        const appState = {
            currentPage: 'Analyze',
            uploadedFile: null,
            imagePreview: null,
            extractedData: null,
            recommendations: null,
            isLoading: false,
            error: null
        };

        // üéØ Demo Data for History (Mirrors React structure)
        const demoHistory = [
            {
                id: 'demo1',
                timestamp: Date.now() - 86400000,
                extractedData: { steps: 8450, calories: 320, distance_km: 5.6, duration_minutes: 48 },
                recommendations: "**Analysis:** Great consistency! You're maintaining above-average activity.\n**Exercise:** Add a 10-min HIIT for stamina.\n**Nutrition:** Try Greek yogurt with berries post-workout! ü´ê"
            },
            {
                id: 'demo2',
                timestamp: Date.now() - 172800000,
                extractedData: { steps: 4200, calories: 190, distance_km: 2.9, duration_minutes: 25 },
                recommendations: "**Analysis:** Needs improvement.\n**Exercise:** Go for a 30-min brisk walk today!\n**Nutrition:** Include more fiber ‚Äî oats & apples üçè."
            },
            {
                id: 'demo3',
                timestamp: Date.now() - 259200000,
                extractedData: { steps: 10320, calories: 450, distance_km: 7.4, duration_minutes: 60 },
                recommendations: "**Analysis:** Fantastic! You‚Äôre smashing goals!\n**Exercise:** Keep a mix of cardio + strength.\n**Nutrition:** Add banana + peanut butter smoothie ü•§."
            }
        ];

        // --- HELPER FUNCTIONS ---

        // Function to create an icon element
        const createIcon = (name, className = 'w-7 h-7 text-indigo-700') => {
            const icon = document.createElement('i');
            icon.setAttribute('data-lucide', name);
            icon.className = className;
            return icon;
        };

        // Custom Card Component HTML builder
        const Card = (title, iconName, content, className = '') => {
            const card = document.createElement('div');
            card.className = `p-8 rounded-3xl border border-white/50 backdrop-blur-lg bg-white/70 shadow-2xl transition duration-500 hover:shadow-indigo-300/50 ${className}`;

            const header = document.createElement('div');
            header.className = 'flex items-center space-x-3 mb-4';
            
            const titleEl = document.createElement('h2');
            titleEl.className = 'text-2xl font-playfair font-semibold text-indigo-900';
            titleEl.textContent = title;

            header.appendChild(createIcon(iconName));
            header.appendChild(titleEl);
            
            card.appendChild(header);
            card.innerHTML += content;

            // Rerender Lucide icons within the new card
            requestAnimationFrame(() => createIcons({ icons: lucide, attrs: { class: 'lucide' }, element: card }));
            
            return card;
        };
        
        // Metric Display HTML builder
        const MetricDisplay = ({ label, value, emoji }) => {
            return `
                <div class="flex items-center space-x-3 p-5 rounded-2xl bg-gradient-to-r from-indigo-100 to-pink-100 shadow-md hover:shadow-pink-300/50 transition duration-300">
                    <span class="text-3xl">${emoji}</span>
                    <div>
                        <p class="text-sm font-medium text-gray-600">${label}</p>
                        <p class="text-xl font-bold text-indigo-900">${value}</p>
                    </div>
                </div>
            `;
        };
        
        // --- EVENT HANDLERS / STATE UPDATERS ---

        const setCurrentPage = (page) => {
            appState.currentPage = page;
            renderApp();
        };

        const handleFileChange = (event) => {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                appState.uploadedFile = file;
                appState.imagePreview = URL.createObjectURL(file);
                appState.error = null;
                appState.extractedData = null;
                appState.recommendations = null;
            } else {
                appState.error = "Please upload a valid image file (JPG, PNG).";
            }
            renderApp();
        };

        const analyzeImage = () => {
            if (!appState.uploadedFile) {
                appState.error = "Please upload an image first.";
                renderApp();
                return;
            }

            // Set loading state and clear previous results
            appState.isLoading = true;
            appState.error = null;
            appState.extractedData = null;
            appState.recommendations = null;
            renderApp(); // Render loading state immediately
            
            // --- DEMO LOGIC (Replace with actual Gemini API call) ---
            setTimeout(() => {
                const demoMetrics = { steps: 7860, calories: 300, distance_km: 4.8, duration_minutes: 45 };
                const demoRecs = "**Analysis:** Solid day! üí™\n**Exercise:** Try adding a 15-min evening jog.\n**Nutrition:** Add almonds and fresh juice post-workout üçä.";

                // Update state with results
                appState.extractedData = demoMetrics;
                appState.recommendations = demoRecs;
                appState.isLoading = false;
                
                // Add to demo history (for display)
                demoHistory.unshift({
                    id: `new-${Date.now()}`,
                    timestamp: Date.now(),
                    extractedData: demoMetrics,
                    recommendations: demoRecs
                });
                
                renderApp(); // Render results
            }, 2000);
            // --- END DEMO LOGIC ---
        };

        // --- VIEW RENDERERS ---
        
        const renderNavLink = (title, iconName, isActive) => {
            const button = document.createElement('button');
            button.className = `flex items-center space-x-3 px-6 py-3 rounded-full font-semibold backdrop-blur-md transition duration-300 transform hover:scale-[1.05] ${
                isActive 
                    ? 'bg-gradient-to-r from-indigo-600 to-pink-600 text-white shadow-lg shadow-pink-400/40' 
                    : 'text-gray-800 bg-white/70 hover:bg-indigo-100 hover:text-indigo-700 border border-gray-200'
            }`;
            button.onclick = () => setCurrentPage(title);
            
            const icon = createIcon(iconName, 'w-5 h-5');
            const span = document.createElement('span');
            span.textContent = title;
            
            button.appendChild(icon);
            button.appendChild(span);
            return button;
        };

        const renderAnalyzeView = () => {
            const { uploadedFile, imagePreview, isLoading, error, extractedData, recommendations } = appState;
            const view = document.createElement('section');
            view.className = "grid grid-cols-1 lg:grid-cols-3 gap-10 mb-10";

            // Map data for MetricDisplay
            const metrics = extractedData ? [
                { label: 'Steps', value: extractedData.steps.toLocaleString(), emoji: 'üö∂' },
                { label: 'Calories', value: extractedData.calories.toLocaleString(), emoji: 'üî•' },
                { label: 'Distance (km)', value: extractedData.distance_km.toFixed(2), emoji: 'üó∫Ô∏è' },
                { label: 'Duration (min)', value: extractedData.duration_minutes, emoji: '‚è±Ô∏è' },
            ] : [];

            // --- 1. Upload Card ---
            let uploadContent = `
                <label class="block cursor-pointer">
                    <input type="file" id="file-upload-input" accept="image/*" class="hidden" />
                    <div class="w-full py-5 text-center text-indigo-800 bg-gradient-to-r from-indigo-50 to-pink-50 border-2 border-dashed border-indigo-400 rounded-xl font-medium hover:shadow-md transition">
                        ${uploadedFile ? '‚úÖ ' + uploadedFile.name : 'Choose a Fitness Dashboard Image'}
                    </div>
                </label>
            `;
            
            if (imagePreview) {
                uploadContent += `<div class="mt-6 border rounded-2xl overflow-hidden shadow-lg"><img src="${imagePreview}" alt="Preview" class="w-full h-auto object-cover" /></div>`;
            }

            const buttonClass = isLoading 
                ? 'bg-gray-400 text-gray-100 cursor-not-allowed' 
                : 'bg-gradient-to-r from-indigo-600 to-pink-600 text-white hover:scale-[1.02] shadow-lg';
            
            const buttonText = isLoading 
                ? '<svg class="animate-spin h-5 w-5 text-white mr-3" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Analyzing with AI‚Ä¶' 
                : 'üöÄ Generate Insights';

            uploadContent += `
                <button id="analyze-button" class="mt-6 w-full py-4 rounded-xl font-bold text-lg flex justify-center items-center space-x-3 transition-all duration-300 ${buttonClass}" ${isLoading || !uploadedFile ? 'disabled' : ''}>
                    ${buttonText}
                </button>
            `;
            
            if (error) {
                 uploadContent += `<p class="mt-4 text-red-600 text-sm bg-red-100 p-4 rounded-xl border border-red-300">${error}</p>`;
            }

            view.appendChild(Card("1. Upload Fitness Screenshot", "CloudUpload", uploadContent));

            // --- 2 & 3. Results Column ---
            const resultsCol = document.createElement('div');
            resultsCol.className = 'lg:col-span-2 space-y-10';

            // -- Extracted Metrics Card --
            let metricsContent = `
                <p class="text-gray-700 mb-6 text-base">Our AI extracts fitness metrics such as steps, calories, and duration from your image.</p>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-6">
                    ${metrics.map(MetricDisplay).join('')}
                </div>
            `;
            
            if (extractedData) {
                metricsContent += `
                    <div class="mt-8 bg-gray-50 border rounded-xl p-5 shadow-inner">
                        <h3 class="text-indigo-700 font-semibold mb-2">Raw JSON Output:</h3>
                        <pre class="text-xs text-gray-700 whitespace-pre-wrap">${JSON.stringify(extractedData, null, 2)}</pre>
                    </div>
                `;
            }

            resultsCol.appendChild(Card("2. Extracted Health Metrics", "BarChart", metricsContent));

            // -- Recommendations Card --
            if (recommendations) {
                const recsContent = `
                    <div class="prose text-gray-800 leading-relaxed">
                        ${recommendations.replace(/\*\*(.*?)\*\*/g, '<strong class="text-indigo-800">$1</strong>').replace(/\n/g, '<br/>')}
                    </div>
                `;
                resultsCol.appendChild(Card("3. Personalized Recommendations", "Utensils", recsContent, "bg-gradient-to-r from-indigo-50 to-pink-50"));
            }

            view.appendChild(resultsCol);
            
            // Attach event listeners after the elements are in the DOM
            requestAnimationFrame(() => {
                document.getElementById('file-upload-input').addEventListener('change', handleFileChange);
                document.getElementById('analyze-button').addEventListener('click', analyzeImage);
            });

            return view;
        };
        
        const renderHistoryView = () => {
            const view = document.createElement('div');
            view.className = "space-y-8";

            view.innerHTML = `
                <h2 class="text-3xl font-playfair font-bold text-indigo-900">üìú Your Fitness History</h2>
                <p class="text-gray-700">A visual log of your AI-generated reports. (Showing ${demoHistory.length} demo entries)</p>
            `;

            demoHistory.forEach((item) => {
                const cardContent = `
                    <p class="text-sm text-gray-500 mb-5 border-b pb-3">Analyzed on <span class="font-semibold text-gray-700">${new Date(item.timestamp).toLocaleString()}</span></p>
                    <h4 class="font-bold text-xl text-indigo-700 mb-4">Summary Metrics üìä:</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        ${MetricDisplay({ label: "Steps", value: item.extractedData.steps, emoji: "üö∂" })}
                        ${MetricDisplay({ label: "Calories", value: item.extractedData.calories, emoji: "üî•" })}
                        ${MetricDisplay({ label: "Distance (km)", value: item.extractedData.distance_km, emoji: "üó∫Ô∏è" })}
                        ${MetricDisplay({ label: "Duration (min)", value: item.extractedData.duration_minutes, emoji: "‚è±Ô∏è" })}
                    </div>
                    <h4 class="font-bold text-xl text-indigo-700 mb-4">Coach's Feedback üß†:</h4>
                    <div class="prose prose-base max-w-none text-gray-800 leading-relaxed bg-gray-50 p-5 rounded-lg border border-gray-200">
                        ${item.recommendations.replace(/\*\*(.*?)\*\*/g, '<strong class="text-indigo-800">$1</strong>').replace(/\n/g, '<br/>')}
                    </div>
                `;
                view.appendChild(Card(`Report: ${item.extractedData.steps} Steps`, "Clock", cardContent));
            });
            return view;
        };

        const renderAboutView = () => {
            const view = document.createElement('div');
            view.className = "space-y-10 max-w-4xl mx-auto";

            const projectVisionContent = `
                <p class="text-lg text-gray-700 font-playfair">
                    The <strong class="text-indigo-800">AI Fitness Health Analyzer</strong> is a state-of-the-art research endeavor designed to transform visual data into meaningful health actions. We aim to eliminate the frustration of raw metrics by providing personalized, expert-level coaching derived directly from your fitness app screenshots.
                </p>
                <ul class="list-disc pl-5 text-gray-700 mt-3 space-y-2">
                    <li><strong class="text-indigo-800">Vision AI Excellence:</strong> We leverage Gemini for robust OCR and complex visual comprehension.</li>
                    <li><strong class="text-indigo-800">Structured Data Guarantee:</strong> Using schema, we ensure every data point is accurately extracted and validated.</li>
                    <li><strong class="text-indigo-800">Secure Progress Tracking:</strong> Analyses are automatically saved for history viewing.</li>
                </ul>
            `;
            view.appendChild(Card("About the Project üî¨", "Info", projectVisionContent));

            const techStackContent = `
                <div class="grid grid-cols-2 gap-6 text-gray-700">
                    <div>
                        <h4 class="font-bold text-indigo-700 text-xl mb-1">Frontend üíª</h4>
                        <p>Vanilla JS, React (Design Origin), Tailwind CSS</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-indigo-700 text-xl mb-1">AI Engine üß†</h4>
                        <p>Gemini 2.5 Flash Multimodal Model (Planned)</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-indigo-700 text-xl mb-1">Data Storage üíæ</h4>
                        <p>Google Firebase Firestore (Planned)</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-indigo-700 text-xl mb-1">Architecture üèóÔ∏è</h4>
                        <p>Single-File Component (SFC) for simplicity</p>
                    </div>
                </div>
            `;
            view.appendChild(Card("Technology & Foundation üß±", "Zap", techStackContent));
            
            const roadmapContent = `
                <ul class="list-decimal pl-5 text-gray-700 space-y-2">
                    <li>Integration with Apple Health & Google Fit</li>
                    <li>AI voice assistant for real-time coaching</li>
                    <li>Personalized weekly reports & leaderboard</li>
                    <li>Gamified health badges</li>
                </ul>
            `;
             view.appendChild(Card("Future Roadmap üöÄ", "Sparkles", roadmapContent));
             
            const acknowledgementsContent = `
                <p class="text-gray-700">Created by <strong>Nitish Kumar</strong> and the Plantgen Team. Powered by Gemini AI and Firebase.</p>
            `;
            view.appendChild(Card("Acknowledgements üí°", "HeartPulse", acknowledgementsContent));


            return view;
        };
        
        // --- MAIN RENDER LOOP ---

        const renderApp = () => {
            const navContainer = document.getElementById('nav-container');
            const contentArea = document.getElementById('content-area');
            
            // 1. Render Navigation
            navContainer.innerHTML = '';
            const tabs = [
                { title: 'Analyze', icon: 'Zap' },
                { title: 'History', icon: 'History' },
                { title: 'About', icon: 'Info' }
            ];
            
            tabs.forEach(tab => {
                navContainer.appendChild(renderNavLink(tab.title, tab.icon, appState.currentPage === tab.title));
            });
            
            // Rerender Lucide icons for the nav
            requestAnimationFrame(() => createIcons({ icons: lucide, attrs: { class: 'lucide' }, element: navContainer }));

            // 2. Render Main Content
            contentArea.innerHTML = '';
            let viewElement;

            switch (appState.currentPage) {
                case 'Analyze':
                    viewElement = renderAnalyzeView();
                    break;
                case 'History':
                    viewElement = renderHistoryView();
                    break;
                case 'About':
                    viewElement = renderAboutView();
                    break;
                default:
                    viewElement = renderAnalyzeView();
            }
            
            contentArea.appendChild(viewElement);
            
            // 3. Ensure all new icons are rendered
            requestAnimationFrame(() => createIcons({ icons: lucide, attrs: { class: 'lucide' }, element: contentArea }));
        };

        // Initialize the application once the script is loaded
